{"chunk":0,"numChunks":1,"fileHash":"R9x5YYQDJ07YSN8+UXs4JLxra8SqPMor6pONYSnJI54=","filePath":"main.go","content":"package main\nimport (\n\t\"forum/internal/database\"\n\t\"forum/internal/handler\"\n\t\"forum/internal/session\"\n\t\"forum/internal/util\"\n\t\"log\"\n\t\"net/http\"\n)\nfunc main() {\n\tutil.LoadTemplates() // Load all templates at startup\n\n\t// Initialize the database\n\tinitializeDatabase()\n\tdefer database.Db.Close()\n\tstartServer()\n}\nfunc startServer() {\n\tregisterHandlers()\n\tserveStaticFiles()\n\tutil.LoadTemplates() // Load all templates at startup\n\tlog.Println(\"Server starting on :8080\")\n\n\t// Homepage handler\n\thttp.HandleFunc(\"/\", handler.HomeHandler)\n\n\t// Use custom 404 handler for undefined routes\n\tlog.Fatal(http.ListenAndServe(\":8080\", http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n\t\tif r.URL.Path != \"/\" && !isRegisteredRoute(r.URL.Path) && !isStaticFile(r.URL.Path) {\n\t\t\tutil.ErrorHandler(w, r, http.StatusNotFound, \"Page Not Found\")\n\t\t\treturn\n\t\t}\n\t\thttp.DefaultServeMux.ServeHTTP(w, r)\n\t})))\n}\nfunc initializeDatabase() {\n\tdatabase.InitDB()\n\tsession.CleanupExpiredSessions()\n\tlog.Println(\"Database initialization complete\")\n}\nfunc serveStaticFiles() {\n\t// Serve static files (CSS, JS, images)\n\tfs := http.FileServer(http.Dir(\"./web/static\"))\n\thttp.Handle(\"/static/\", http.StripPrefix(\"/static/\", fs))\n}\nfunc registerHandlers() {\n\t// Register HTTP handlers\n\thttp.HandleFunc(\"/register\", handler.JSONWrapper(handler.RegisterHandler))\n\thttp.HandleFunc(\"/login\", handler.JSONWrapper(handler.LoginHandler))\n\thttp.HandleFunc(\"/createPost\", handler.CreatePostHandler)\n\thttp.HandleFunc(\"/comment\", handler.CommentHandler)\n\thttp.HandleFunc(\"/like\", handler.LikeHandler)\n\thttp.HandleFunc(\"/filter\", handler.FilterHandler)\n\thttp.HandleFunc(\"/post\", handler.ViewPostHandler) // New route to display posts\n\thttp.HandleFunc(\"/logout\", handler.LogoutHandler) // New route to handle logout\n}"}